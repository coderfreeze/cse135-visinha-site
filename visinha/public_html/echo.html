<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Echo Form</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
        }
        main {
            display: flex;
            gap: 3rem;
            width: 100%;
            max-width: 43rem;
            margin-top: 5rem;
        }
        section { 
            flex: 1; 
        }
        label { 
            display: block; 
            margin-top: 15px; 
            font-weight: bold; 
            font-size: 0.9rem; 
        }
        select, input { 
            display: block; 
            margin-top: 5px; 
            padding: 5px; 
            width: 100%; 
            box-sizing: border-box; 
        }
        button { 
            margin-top: 1.5rem; 
            padding: 0.5rem 1rem;
            cursor: pointer; 
        }
        strong { 
            display: block; 
            margin-top: 1rem; 
            text-decoration: underline; 
            font-size: 0.9rem; 
        }
        output { 
            display: block; 
            padding: 10px; 
            white-space: pre-wrap; 
            font-size: 0.85rem;
            margin-top: 5px;
        }
        #jsForm {display: none;}
    </style>
</head>
<body>

<main>
    <section>
        <h2>Input</h2>
        
        <noscript>
            <p>JavaScript is off. The PUT, DELETE request type and JSON encoding is disabled.</p>
            
            <h2>POST</h2>
            <form action="/cgi-bin/echo-python.py" method="POST">
                <label>Message
                    <input type="text" name="message" placeholder="Enter a Message">
                </label>
                <div style="margin-bottom: 15px;">
                    <button type="submit" formaction="/cgi-bin/echo-python.py">Python</button>
                    <button type="submit" formaction="/cgi-bin/echo-cpp">C++</button>
                    <button type="submit" formaction="/node/echo-node">Node.js</button>
                </div>
            </form>

            <h2>GET</h2>
            <form action="/cgi-bin/echo-python.py" method="GET">
                <label>Message
                    <input type="text" name="message" placeholder="Enter a Message">
                </label>
                <div style="margin-bottom: 15px;">
                    <button type="submit" formaction="/cgi-bin/echo-python.py">Python</button>
                    <button type="submit" formaction="/cgi-bin/echo-cpp">C++</button>
                    <button type="submit" formaction="/node/echo-node">Node.js</button>
                </div>
            </form>
        </noscript>
        
        <form id="jsForm" action="/cgi-bin/echo-python.py" method="POST">
            <label>Language
                <select id="lang">
                    <option value="python">Python</option>
                    <option value="cpp">C++</option>
                    <option value="node">Node.js</option>
                </select>
            </label>

            <label>Method
                <select id="method">
                    <option value="GET">GET</option>
                    <option value="POST" selected>POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                </select>
            </label>

            <label>Encoding
                <select id="encoding">
                    <option value="application/x-www-form-urlencoded">x-www-form-urlencoded</option>
                    <option value="application/json">application/json</option>
                </select>
            </label>

            <label>Message
                <input type="text" name="message" placeholder="Enter a Message">
            </label>

            <button type="submit">Submit</button>
        </form>
    </section>

    <section>
        <h2>Response</h2>
        <strong>Server Data:</strong>
        <output>--</output>
    </section>
</main>

<script>
    document.getElementById('jsForm').style.display = 'block';

    const endpoints = {
        'python': '/cgi-bin/echo-python.py',
        'cpp': '/cgi-bin/echo-cpp',
        'node': '/node/echo-node' 
    };

    const form = document.getElementById('jsForm');
    const outData = document.querySelector('output');

    form.addEventListener('submit', async (e) => {
        e.preventDefault(); 

        outData.textContent = "Loading...";

        const lang = document.getElementById('lang').value;
        const method = document.getElementById('method').value;
        const enc = document.getElementById('encoding').value;
        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());

        let url = endpoints[lang];
        let options = { method: method, headers: {} };

        if (method === 'GET' || method === 'DELETE') {
            url += '?' + new URLSearchParams(payload).toString();
        } else {
            if (enc === 'application/json') {
                options.headers['Content-Type'] = 'application/json';
                options.body = JSON.stringify(payload);
            } else {
                options.headers['Content-Type'] = 'application/x-www-form-urlencoded';
                options.body = new URLSearchParams(payload);
            }
        }

        try {
            const res = await fetch(url, options);
            const text = await res.text();
            outData.textContent = text;
        } catch (err) {
            outData.textContent = "Error: " + err;
        }
    });
</script>

</body>
</html>